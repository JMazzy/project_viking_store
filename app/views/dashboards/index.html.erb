<h1>Viking Store Analytics Dashboard</h1>

<div class="row">
  <div class='col-md-6'>
    <h2>1. Overall Platform</h2>

    <div class="row">
      <div class='col-md-12'>
        <h3>Total</h3>
        <table class='table'>
          <tr>
            <td>Item</td>
            <td>Data</td>
          </tr>
          <tr>
            <td>Total Users</td>
            <td><%= @num_total_users %></td>
          </tr>
          <tr>
            <td>Orders</td>
            <td><%= @num_total_orders %></td>
          </tr>
          <tr>
            <td>Products</td>
            <td><%= @num_total_products %></td>
          </tr>
          <tr>
            <td>Revenue</td>
            <td><%= number_to_currency(@total_revenue) %></td>
          </tr>
        </table>
      </div>
    </div>
    <div class= "row">
      <div class='col-md-12'>
        <h3>Last 30 Days</h3>
        <table class='table'>
          <tr>
            <td>Item</td>
            <td>Data</td>
          </tr>
          <tr>
            <td>New Users</td>
            <td><%= @users_30 %></td>
          </tr>
          <tr>
            <td>Orders</td>
            <td><%= @orders_30 %></td>
          </tr>
          <tr>
            <td>Products</td>
            <td><%= @products_30 %></td>
          </tr>
          <tr>
            <td>Revenue</td>
            <td><%= number_to_currency(@revenue_30) %></td>
          </tr>
        </table>
      </div>
    </div>
    <div class= "row">
      <div class='col-md-12'>
        <h3>Last 7 Days</h3>
        <table class='table'>
          <tr>
            <td>Item</td>
            <td>Data</td>
          </tr>
          <tr>
            <td>New Users</td>
            <td><%= @users_7 %></td>
          </tr>
          <tr>
            <td>Orders</td>
            <td><%= @orders_7 %></td>
          </tr>
          <tr>
            <td>Products</td>
            <td><%= @products_7 %></td>
          </tr>
          <tr>
            <td>Revenue</td>
            <td><%= number_to_currency(@revenue_7) %></td>
          </tr>
        </table>
      </div>
    </div>
  </div>
  <div class='col-md-6'>
    <h2>2. User Demographics and Behavior</h2>

    <div class="row">
      <div class='col-md-12'>
        <h3>Top 3 States Users Live In (billing)</h3>
        <table class='table'>
          <tr>
            <td>Item</td>
            <td>Data</td>
          </tr>
          <tr>
            <td><%= @top_states[0].name %></td>
            <td><%= @top_states[0].state_count %></td>
          </tr>
          <tr>
            <td><%= @top_states[1].name %></td>
            <td><%= @top_states[1].state_count %></td>
          </tr>
          <tr>
            <td><%= @top_states[2].name %></td>
            <td><%= @top_states[2].state_count %></td>
          </tr>
        </table>
      </div>
    </div>
    <div class= "row">
      <div class='col-md-12'>
        <h3>Top 3 Cities Users Live In (billing)</h3>
        <table class='table'>
          <tr>
            <td>Item</td>
            <td>Data</td>
          </tr>
          <tr>
            <td><%= @top_cities[0].name %></td>
            <td><%= @top_cities[0].city_count %></td>
          </tr>
          <tr>
            <td><%= @top_cities[1].name %></td>
            <td><%= @top_cities[1].city_count %></td>
          </tr>
          <tr>
            <td><%= @top_cities[2].name %></td>
            <td><%= @top_cities[2].city_count %></td>
          </tr>
        </table>
      </div>
    </div>
    <div class= "row">
      <div class='col-md-12'>
        <h3>Top User With...</h3>
        <table class='table'>
          <tr>
            <td>Item</td>
            <td>User</td>
            <td>Quantity</td>
          </tr>
          <tr>
            <td>Highest Single Order</td>
            <td><%="#{@user_highest_single_order[0].first_name} #{@user_highest_single_order[0].last_name}" %></td>
            <td><%= number_to_currency(@user_highest_single_order[0].highest) %></td>
          </tr>
          <tr>
            <td>Highest Lifetime Value</td>
            <td><%= "#{@user_highest_lifetime_value[0].first_name} #{@user_highest_lifetime_value[0].last_name}" %></td>
            <td><%= number_to_currency(@user_highest_lifetime_value[0].total_revenue) %></td>
          </tr>
          <tr>
            <td>Highest Average Value</td>
            <td><%= "#{@user_highest_average_value[0].first_name} #{@user_highest_average_value[0].last_name}" %></td>
            <td><%= number_to_currency(@user_highest_average_value[0].highest) %></td>
          </tr>
          <tr>
            <td>Most Orders</td>
            <td><%= "#{@user_most_orders[0].first_name} #{@user_most_orders[0].last_name}" %></td>
            <td><%=@user_most_orders[0].most_orders%></td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class='col-md-6'>
    <h2>3. Order Statistics</h2>

    <div class="row">
      <div class='col-md-12'>
        <h3>Total</h3>
        <table class='table'>
          <tr>
            <td>Item</td>
            <td>Data</td>
          </tr>
          <tr>
            <td>Number of Orders</td>
            <td><%= @num_total_orders %></td>
          </tr>
          <tr>
            <td>Total Revenue</td>
            <td><%= number_to_currency(@total_revenue) %></td>
          </tr>
          <tr>
            <td>Average Order Value</td>
            <td><%= number_to_currency(@average_order_value) %></td>
          </tr>
          <tr>
            <td>Largest Order Value</td>
            <td><%= number_to_currency(@highest_single_order) %></td>
          </tr>
        </table>
      </div>
    </div>
    <div class= "row">
      <div class='col-md-12'>
        <h3>Last 30 Days</h3>
        <table class='table'>
          <tr>
            <td>Item</td>
            <td>Data</td>
          </tr>
          <tr>
            <td>Number of Orders</td>
            <td><%=  @orders_30 %></td>
          </tr>
          <tr>
            <td>Total Revenue</td>
            <td><%= number_to_currency( @revenue_30 )%></td>
          </tr>
          <tr>
            <td>Average Order Value</td>
            <td><%= number_to_currency( @average_order_value_30 )%></td>
          </tr>
          <tr>
            <td>Largest Order Value</td>
            <td><%= number_to_currency( @highest_single_order_30 )%></td>
          </tr>
        </table>
      </div>
    </div>
    <div class= "row">
      <div class='col-md-12'>
        <h3>Last 7 Days</h3>
        <table class='table'>
          <tr>
            <td>Item</td>
            <td>Data</td>
          </tr>
          <tr>
            <td>Number of Orders</td>
            <td><%=  @orders_7%></td>
          </tr>
          <tr>
            <td>Total Revenue</td>
            <td><%= number_to_currency( @revenue_7 )%></td>
          </tr>
          <tr>
            <td>Average Order Value</td>
            <td><%= number_to_currency( @average_order_value_7 )%></td>
          </tr>
          <tr>
            <td>Largest Order Value</td>
            <td><%= number_to_currency( @highest_single_order_7 )%></td>          </tr>
        </table>
      </div>
    </div>
  </div>
  <div class='col-md-6'>
    <h2>4. Time Series Data</h2>

    <div class="row">
      <div class='col-md-12'>
        <h3>Orders by day</h3>
        <table class='table'>
          <tr>
            <td>Date</td>
            <td>Quantity</td>
            <td>Value</td>
          </tr>
          <tr>
            <td>Today</td>
            <td><%=@num_orders_last_week[0] %></td>
            <td><%= number_to_currency(@revenue_last_week[0]) %></td>
          </tr>
          <tr>
            <td>Yesterday</td>
            <td><%=@num_orders_last_week[1] %></td>
            <td><%= number_to_currency(@revenue_last_week[1]) %></td>
          </tr>
          <tr>
            <td><%= @dates_last_week[2] %> </td>
            <td><%=@num_orders_last_week[2] %></td>
            <td><%= number_to_currency(@revenue_last_week[2]) %></td>
          </tr>
          <tr>
            <td><%= @dates_last_week[3] %> </td>
            <td><%=@num_orders_last_week[3] %></td>
            <td><%= number_to_currency(@revenue_last_week[3]) %></td>
          </tr>
          <tr>
            <td><%= @dates_last_week[4] %> </td>
            <td><%=@num_orders_last_week[4] %></td>
            <td><%= number_to_currency(@revenue_last_week[4]) %></td>
          </tr>
          <tr>
            <td><%= @dates_last_week[5] %> </td>
            <td><%=@num_orders_last_week[5] %></td>
            <td><%= number_to_currency(@revenue_last_week[5]) %></td>
          </tr>
          <tr>
            <td><%= @dates_last_week[6] %> </td>
            <td><%=@num_orders_last_week[6] %></td>
            <td><%=number_to_currency(@revenue_last_week[6]) %></td>
          </tr>
        </table>
      </div>
    </div>
    <div class= "row">
      <div class='col-md-12'>
        <h3>Orders by week</h3>
        <table class='table'>
          <tr>
            <td>Date</td>
            <td>Quantity</td>
            <td>Value</td>
          </tr>

          <% (0...7).each do |num| %>

          <% case num %>
          <% when 0 %>
          <%   week_str = "This Week"%>
          <% when 1 %>
          <%   week_str = "Last Week" %>
          <% else %>
          <%  week_str = "#{num} Weeks Ago" %>
          <% end %>
            <tr>
              <td><%= week_str %></td>
              <td><%= @num_orders_past_n_weeks[num] %></td>
              <td><%= number_to_currency(@revenue_past_n_weeks[num]) %></td>
            </tr>
          <% end %>

        </table>
      </div>
    </div>
  </div>
</div>
